# Гибкий ввод числовых значений в LysoData-Miner

## Обзор

В системе LysoData-Miner реализована революционная система ввода числовых значений для тестов, которая позволяет пользователям указывать как точные значения, так и диапазоны с максимальной гибкостью.

## Возможности системы

### 1. Режимы ввода

#### Режим точного значения
- Пользователь может ввести конкретное числовое значение
- Поддерживаются целые числа и числа с плавающей точкой
- Единицы измерения отображаются автоматически (°C, мм, pH и т.д.)

#### Режим диапазона
- Пользователь может задать минимальное и максимальное значения
- Ползунки для интуитивного выбора границ диапазона
- Автоматическая валидация (мин < макс)
- Синхронизация между полями ввода и ползунками

### 2. Компоненты системы

#### NumericTestInput.tsx
```typescript
interface NumericTestValue {
  exact?: number;
  range?: {
    min: number;
    max: number;
  };
  mode: 'exact' | 'range';
}
```

**Ключевые особенности:**
- Переключение между режимами одним кликом
- Двойные ползунки с разными цветами (синий/зеленый)
- Поля ввода с автоматической валидацией
- Кнопка очистки для сброса значений
- Отображение единиц измерения

#### BooleanTestInput.tsx
```typescript
interface BooleanTestValue {
  value: '+' | '-' | '+/-' | 'n.d.';
}
```

**Возможности:**
- Четыре варианта ответа с цветовой кодировкой
- Зеленый: Положительный (+)
- Красный: Отрицательный (-)
- Желтый: Переменный (+/-)
- Серый: Нет данных (n.d.)

### 3. UI/UX улучшения

#### Визуальная обратная связь
- Цветовая кодировка для разных состояний
- Анимированные переходы между режимами
- Активные и неактивные состояния ползунков
- Подсказки при наведении

#### Пользовательский опыт
- Интуитивное переключение между режимами
- Автоматическая синхронизация полей
- Мгновенная валидация ввода
- Возможность отмены выбора

### 4. Алгоритм сравнения

#### Точные значения
```sql
CASE WHEN ABS(strain_value - user_value) <= tolerance THEN 'match'
     ELSE 'mismatch'
END
```

#### Диапазоны
```sql
CASE WHEN strain_value BETWEEN min_value - tolerance AND max_value + tolerance THEN 'match'
     WHEN strain_value BETWEEN min_value - tolerance*2 AND max_value + tolerance*2 THEN 'partial_match'
     ELSE 'mismatch'
END
```

### 5. Технические детали

#### Frontend (React + TypeScript)
- Двухступенчатый range slider с кастомными стилями
- Debounce для производительности
- Автоматическая типизация TypeScript
- Responsive design для мобильных устройств

#### Backend (FastAPI + PostgreSQL)
- Новые Pydantic модели для валидации
- Гибкая SQL генерация для разных типов сравнения
- Поддержка legacy формата для обратной совместимости
- Оптимизированные запросы с CTE

### 6. Примеры использования

#### Температура роста
```
Режим: Диапазон
Минимум: 15°C
Максимум: 42°C
Описание: "Оптимальный диапазон роста штамма"
```

#### pH оптимум
```
Режим: Точное значение
Значение: 7.2
Описание: "Точный pH оптимум для данного штамма"
```

#### Размер клеток
```
Режим: Диапазон
Минимум: 0.5 мкм
Максимум: 2.1 мкм
Описание: "Диапазон размеров клеток в культуре"
```

### 7. Преимущества

#### Для пользователей
- Максимальная гибкость ввода данных
- Интуитивный интерфейс
- Быстрое переключение между режимами
- Визуальная обратная связь

#### Для исследователей
- Возможность указать точность измерений
- Учет естественной вариабильности биологических данных
- Более точная идентификация штаммов
- Количественная оценка степени соответствия

#### Для системы
- Улучшенная точность идентификации
- Гибкие алгоритмы сравнения
- Поддержка частичных совпадений
- Масштабируемость для новых типов тестов

### 8. Настройки и кастомизация

#### Tolerance (Допуск)
- Настраиваемый параметр для каждого запроса
- По умолчанию: 2.0 единицы
- Влияет на строгость сравнения
- Отдельная обработка для диапазонов

#### Confidence Score
- Автоматический расчет уверенности
- Учитывает качество совпадений
- Штрафует за конфликты
- Диапазон: 0-1 (чем выше, тем лучше)

## Заключение

Новая система ввода числовых значений в LysoData-Miner представляет значительный шаг вперед в области биоинформатических инструментов для идентификации микроорганизмов. Комбинация гибкого пользовательского интерфейса и интеллектуальных алгоритмов сравнения обеспечивает максимальную точность и удобство работы с системой.

Система полностью готова к продуктивному использованию и может быть легко расширена для поддержки дополнительных типов тестов и измерений. 